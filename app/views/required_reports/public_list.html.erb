<% provide :page_title, construct_page_title('Required Reports') %>
<h1>Required Reports</h1>

<div id="required-report-filters" style="padding-bottom: 10px; text-align: center;">
  <span>Filter by Agency:</span>
  <div id="agency-dropdown" class="btn-group" style="padding-right: 10px">
    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
      <% if params[:agency] != nil %>
        <%= params[:agency] %>
      <% else %>
        All
      <% end %>
      <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
      <li role="menuitem"><a href="/required_reports/public_list?locale=en&amp;per_page=<%= params[:per_page] %>&amp;agency=All">All</a></li>
      <% @agencies.each do |agency| %>
        <li role="menuitem"><a href="/required_reports/public_list?locale=en&amp;per_page=<%= params[:per_page] %>&amp;agency=<%= agency.name %>"><%= agency.name %></a></li>
      <% end %>
    </ul>
  </div>

  <span>Rows per Page:</span>
  <div id="per_page-dropdown" class="btn-group">
    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
      <% if params[:per_page] != nil %>
        <%= params[:per_page] %>
      <% else %>
        20
      <% end %> per page <span class="caret"></span>
    </button>
    <ul class="dropdown-menu" role="menu">
      <li role="menuitem"><a href="/required_reports/public_list?locale=en&amp;per_page=10&amp;agency=<%= params[:agency] %>">10<span class="sr-only"> per page</span></a></li>
      <li role="menuitem"><a href="/required_reports/public_list?locale=en&amp;per_page=20&amp;agency=<%= params[:agency] %>">20<span class="sr-only"> per page</span></a></li>
      <li role="menuitem"><a href="/required_reports/public_list?locale=en&amp;per_page=50&amp;agency=<%= params[:agency] %>">50<span class="sr-only"> per page</span></a></li>
      <li role="menuitem"><a href="/required_reports/public_list?locale=en&amp;per_page=100&amp;agency=<%= params[:agency] %>">100<span class="sr-only"> per page</span></a></li>
    </ul>
  </div>
</div>

<div style="text-align: center;">
  <%= paginate @required_reports %>
</div>

<div class="table-responsive">
  <table id="required-report-table" class="table table-striped table-bordered">
    <thead>
    <tr>
      <th class="col-md-2">ID</th>
      <th class="col-md-2">Agency</th>
      <th class="col-md-2">Name</th>
      <th class="col-md-3">Description</th>
      <th class="col-md-1">Frequency</th>
      <th class="col-md-1">Authorizing Resource (Local Law)</th>
      <th class="col-md-1">Authorizing Resource (Charter and Code)</th>
      <th class="col-md-1">Last Published Date</th>
      <th class="col-md-1">See All Reports</th>
    </tr>
    </thead>

    <tbody>
    <% @required_reports.each_with_index do |required_report, index| %>
      <tr>
        <th aria-label="ID: <%= index + 1 %>. Agency: <%= required_report.agency_name %>. Report Name: <%= required_report.name %>. The value in this cell is "><%= index + 1 %></th>
        <td><%= required_report.agency_name %></td>
        <td><%= required_report.name %></td>
        <td><%= required_report.description %></td>
        <td><%= required_report.frequency_string %></td>
        <td><%= required_report.local_law %></td>
        <td><%= required_report.charter_and_code %></td>
        <td><%= required_report.last_published_date %></td>
        <td><%= link_to 'Search', @search_url[0] + url_encode(required_report.agency_name) + @search_url[1] + url_encode(required_report.name) + @search_url[2], aria: { label: format('Search all, %s for %s', required_report.name, required_report.agency_name) } %></td>
      </tr>
    <% end %>
    </tbody>
  </table>
</div>

<div style="text-align: center;">
  <%= paginate @required_reports %>
</div>
